<!DOCTYPE html>

<!-- head -->
<head>
    <meta charset="UTF-8">
    <meta name="keywords" content="python, cross-validation, scikit-learn, machine-learning" />

    <title>Alessandro Nicolosi's blog</title>
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
</head>
<!-- end_head -->
<body>

<div class="container">


<!--navigation-->

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <a class="navbar-brand" href=""><img src="/assets/img/logo.png" height="30" alt=""></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarsExampleDefault">
    <div class="navbar-nav">
      <a class="nav-item nav-link active" href="">Home<span class="sr-only">(current)</span></a>
      <a class="nav-item nav-link" href="#">About me</a>
    </div>
  </div>
</nav>

  <!--end_navigation-->

<article>
  <h1 class='title'>Cross Validation with scikit-learn
    
    <br>
    <span class="subtitle"></span>
  

  </h1>

  
<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">sklearn.datasets</span> <span class="k">as</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">RANDOM_SEED</span> <span class="o">=</span> <span class="mi">123</span>

<span class="n">digits</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_digits</span><span class="p">()</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">digits</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="o">*</span><span class="mi">8</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">digits</span><span class="o">.</span><span class="n">target</span>

<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_SEED</span><span class="p">)</span>
<span class="n">train_val_index_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">train_i</span><span class="p">,</span> <span class="n">val_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">train_i</span><span class="p">,</span> <span class="n">val_i</span> <span class="ow">in</span> <span class="n">skf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>

<span class="n">models</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fold_accuracy</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">fold</span><span class="p">,</span> <span class="n">indexes</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_val_index_list</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Training fold {fold}"</span><span class="p">)</span>

    <span class="n">train_index</span><span class="p">,</span> <span class="n">val_index</span> <span class="o">=</span> <span class="n">indexes</span>

    <span class="n">X_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">train_index</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_index</span><span class="p">]</span>
    <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">val_index</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">val_index</span><span class="p">]</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">MLPClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">RANDOM_SEED</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
    <span class="n">val_acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"val accuracy: {val_acc:4f}"</span><span class="p">)</span>

    <span class="n">fold_accuracy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val_acc</span><span class="p">)</span>
    <span class="n">models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Cross-validation accuracy: {np.mean(fold_accuracy):4f}"</span><span class="p">)</span></code></pre></figure>

<p>You can download the code from: <a href="/assets/code/cross-validation/cross-validation.py">cross-validation.py</a></p>


</article>
</div>

  <footer class="footer bg-dark text-light text-center">
    <div class="container">
      <br>
      <a href="https://github.com/alenic" class="fa fa-github"></a>
      <a href="https://www.linkedin.com/in/alessandro-nicolosi-88a29b7b/" class="fa fa-linkedin"></a>
    </div>
</footer>
  
  <script src="/bower_components/jquery/dist/jquery.min.js"></script>
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config( 
						{
							tex2jax: {inlineMath: [['$','$']],
												displayMath: [['$$','$$']]
						},
							"HTML-CSS": {preferredFont: "TeX", scale: 100},
							styles : {
							".MathJax" : {
									 "font-size": "100% !important"
								}
							}
						});
	</script>

</body>
</html>